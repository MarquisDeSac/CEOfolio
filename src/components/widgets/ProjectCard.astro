---
import type { CollectionEntry } from 'astro:content'

import { resolvePath } from '~/utils/path'

interface Props {
  project: CollectionEntry<'projects'>
  index: number
}

const { project, index } = Astro.props
const { id, data } = project

const colors = ['neon-blue', 'neon-pink', 'sunset-purple']
const color = colors[index % 3]

const lang = Astro.url.pathname.split('/').includes('en') ? 'en' : 'fr'

const skills = (lang === 'en' ? data.skills_en : data.skills) || data.skills || []
const displaySkills = skills.slice(0, 5)
const remainingSkills = skills.length - 5

const description = (lang === 'en' ? data.desc_en : data.desc) || data.desc
const viewDetails = lang === 'en' ? 'View Details' : 'Voir les détails'
const skillsTitle = lang === 'en' ? 'Skills' : 'Compétences'
---

<a href={resolvePath(`/${lang}/projects/${id}`)} class={`group grid grid-cols-1 md:grid-cols-4 gap-6 p-6 rounded-xl border border-black/10 dark:border-white/10 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-all duration-300 no-underline relative overflow-hidden
  hover:border-${color} hover:shadow-[0_0_20px_rgba(var(--c-${color}),0.2)]`}
>
  <!-- Background Gradient -->
  <div class={`absolute inset-0 bg-gradient-to-r from-${color}/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500`}></div>

  <!-- 1/4 Left: Image/Icon -->
  <div class="col-span-1 flex items-center justify-center p-4 bg-black/5 dark:bg-white/5 rounded-lg aspect-video md:aspect-square">
    {data.images && data.images.length > 0 ? (
      <img src={data.images[0]} alt={data.id} class="w-full h-full object-cover rounded" />
    ) : (
      <div class={`text-6xl text-${color} opacity-80 group-hover:scale-110 transition-transform duration-300 ${data.icon}`}></div>
    )}
  </div>

  <!-- 2/4 Center: Content -->
  <div class="col-span-1 md:col-span-2 flex flex-col justify-center gap-2 z-10">
    <div class="flex items-center gap-3 mb-1">
      {data.client && (
        <span class="text-xs font-mono opacity-50 uppercase tracking-widest u-text-main">{data.client}</span>
      )}
      {data.date && (
         <span class="text-xs opacity-40 px-2 py-0.5 border border-black/10 dark:border-white/10 rounded-full u-text-main">{data.date}</span>
      )}
    </div>
    
    <h3 class={`text-2xl font-display font-bold u-text-main group-hover:text-${color} transition-colors`}>
      {data.id // Using ID as title for now
        .split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
      }
    </h3>
    
    <p class="u-text-muted text-sm leading-relaxed line-clamp-3">
      {description}
    </p>

    <!-- Call to action hint -->
    <div class={`mt-auto text-xs font-bold text-${color} opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all duration-300 flex items-center gap-1`}>
      {viewDetails} <span class="i-ri-arrow-right-line"></span>
    </div>
  </div>

  <!-- 1/4 Right: Skills -->
  <div class="col-span-1 flex flex-col gap-3 z-10 border-l border-black/10 dark:border-white/10 pl-0 md:pl-6 pt-4 md:pt-0">
    <h4 class="text-xs font-bold opacity-50 uppercase tracking-widest u-text-muted">{skillsTitle}</h4>
    <div class="flex flex-wrap gap-2">
      {displaySkills.map(skill => (
        <span class={`px-2 py-1 text-xs rounded border border-${color}/30 bg-${color}/5 text-${color} whitespace-nowrap`}>
          {skill}
        </span>
      ))}
      {remainingSkills > 0 && (
        <span class="px-2 py-1 text-xs rounded border border-black/10 dark:border-white/10 bg-black/5 dark:bg-white/5 u-text-muted opacity-60" title={skills.slice(5).join(', ')}>
          +{remainingSkills}
        </span>
      )}
    </div>
  </div>
</a>

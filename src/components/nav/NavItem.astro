---
import Link from '~/components/base/Link.astro'
import { resolvePath } from '~/utils/path'

import type { InternalNav, SocialLink } from '~/types'

type Props =
  | {
      type: 'internal'
      item: InternalNav
      mergeOnMobile: boolean
      mobileItemType?: 'text' | 'icon'
    }
  | {
      type: 'social'
      item: SocialLink
      mergeOnMobile: boolean
      mobileItemType?: 'text' | 'icon'
    }

const { type, item, mergeOnMobile, mobileItemType } = Astro.props

const lang = Astro.url.pathname.startsWith('/en') ? 'en' : 'fr'
const localizedPath = type === 'internal' ? `/${lang}${item.path.replace(/\/$/, '')}` : item.path

// Simple Translation Map for Nav Items
const navTranslations: Record<string, { en: string, fr: string }> = {
  'Projets': { en: 'Projects', fr: 'Projets' },
  'Expériences': { en: 'Experiences', fr: 'Expériences' },
  'Parcours': { en: 'Education', fr: 'Parcours' },
  'Compétences': { en: 'Skills', fr: 'Compétences' },
  'Contact': { en: 'Contact', fr: 'Contact' }
}

const originalText = item.text || item.title
const translatedText = (type === 'internal' && navTranslations[originalText]) 
  ? navTranslations[originalText][lang] 
  : originalText

const href = type == 'internal' ? resolvePath(localizedPath) : item.link
const rel = type === 'internal' ? undefined : 'me'
const external = type === 'internal' ? false : true
const ariaCurrent =
  type === 'internal'
    ? Astro.url.pathname.replace(/\/$/, '') === resolvePath(localizedPath).replace(/\/$/, '')
      ? 'page'
      : false
    : undefined
---

{
  mergeOnMobile ? (
    mobileItemType ? (
      mobileItemType === 'text' ? (
        (item.displayMode === 'alwaysText' ||
          item.displayMode === 'iconToTextOnMobile') && (
          <li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6">
            <Link
              class="block op-transition op-100 text-[var(--c-text)]"
              href={href}
              title={translatedText}
              rel={rel}
              external={external}
              aria-current={ariaCurrent}
            >
              <span>{translatedText}</span>
            </Link>
          </li>
        )
      ) : (
        (item.displayMode === 'alwaysIcon' ||
          item.displayMode === 'textToIconOnMobile') && (
          <Link
            class="block op-transition op-100 text-[var(--c-text)]"
            href={href}
            title={translatedText}
            rel={rel}
            external={external}
            aria-current={ariaCurrent}
          >
            <div class={item.icon} />
          </Link>
        )
      )
    ) : (
      <Link
        class="lt-md:hidden op-transition op-100 text-[var(--c-text)]"
        href={href}
        title={translatedText}
        rel={rel}
        external={external}
        aria-current={ariaCurrent}
      >
        {(item.displayMode === 'alwaysIcon' ||
          item.displayMode === 'iconHiddenOnMobile' ||
          item.displayMode === 'iconToTextOnMobile') && (
          <div class={item.icon} />
        )}
        {(item.displayMode === 'alwaysText' ||
          item.displayMode === 'textHiddenOnMobile' ||
          item.displayMode === 'textToIconOnMobile') && (
          <span>{translatedText}</span>
        )}
      </Link>
    )
  ) : (
    <Link
      class={`${
        item.displayMode === 'iconHiddenOnMobile' ||
        item.displayMode === 'textHiddenOnMobile'
          ? 'lt-md:hidden'
          : ''
      } op-transition op-100 text-[var(--c-text)]`}
      href={href}
      title={translatedText}
      rel={rel}
      external={external}
      aria-current={ariaCurrent}
    >
      {(item.displayMode === 'alwaysText' ||
        item.displayMode === 'textHiddenOnMobile') && <span>{translatedText}</span>}
      {(item.displayMode === 'alwaysIcon' ||
        item.displayMode === 'iconHiddenOnMobile') && <div class={`${item.icon} text-2xl`} />}
      {item.displayMode === 'textToIconOnMobile' && (
        <>
          <span class="lt-md:hidden">{translatedText}</span>
          <div class={`md:hidden ${item.icon} text-2xl`} />
        </>
      )}
      {item.displayMode === 'iconToTextOnMobile' && (
        <>
          <span class="md:hidden">{translatedText}</span>
          <div class={`lt-md:hidden ${item.icon} text-2xl`} />
        </>
      )}
    </Link>
  )
}
